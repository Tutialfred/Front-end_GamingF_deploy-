"use strict";var e=require("./index-8c2a3b3d.cjs"),r=require("react"),t=require("uploadcare-widget"),n=require("./default-preview-url-callback-60ccb260.cjs");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("react-fast-compare"),require("@uploadcare/client-suspense");var l=a(r),o=a(t),i=["value","apiRef","onTabChange","onChange","onProgress","customTabs","previewUrlCallback","metadataCallback"],u={height:"500px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},c=function(e,r){var t=[];return e&&(t=Array.isArray(e)?e:[e]),t};exports.default=function(t){var a=r.useState((function(){return"uploadcare-".concat(Date.now())})),s=e._slicedToArray(a,1)[0],f=r.useMemo((function(){return l.default.createElement("style",null,function(e){return"\n  .".concat(e," .uploadcare--preview__done:not(.uploadcare-tab-effects--done),\n  .").concat(e," .uploadcare--panel__done:not(.uploadcare-tab-effects--done) {\n    display: none;\n  }\n")}(s))}),[s]),d=function(t,a){var l=t.value,o=t.apiRef,u=t.onTabChange,s=t.onChange,f=t.onProgress,d=t.customTabs,C=t.previewUrlCallback,b=t.metadataCallback,m=e._objectWithoutProperties(t,i),p=m.tabsCss,v=m.locale,A=m.localeTranslations,L=m.localePluralize,w=r.useRef(null),y=r.useRef(null),_=n.useCommitedCallback(u),E=n.useCommitedCallback(s),T=n.useCommitedCallback(f),R=n.useCommitedCallback(b),g=n.useCommitedCallback(C||n.defaultPreviewUrlCallback);return n.useCustomTabs(d,a),n.useDeepEffect((function(){return v&&(window.UPLOADCARE_LOCALE=v),L&&(window.UPLOADCARE_LOCALE_PLURALIZE=L),A&&(window.UPLOADCARE_LOCALE_TRANSLATIONS=A),function(){v&&delete window.UPLOADCARE_LOCALE,L&&delete window.UPLOADCARE_LOCALE_PLURALIZE,A&&delete window.UPLOADCARE_LOCALE_TRANSLATIONS}}),[v,L,A]),r.useEffect((function(){a&&p&&"string"==typeof p&&(0===p.indexOf("https://")?a.tabsCss.addUrl(p):a.tabsCss.addStyle(p))}),[a,p]),r.useEffect((function(){var r=c(l);y.current&&y.current.reject(),y.current=a.openPanel(w.current,r,e._objectSpread2(e._objectSpread2({multipleMax:m.multiple?void 0:1},m),{},{multiple:!0,metadataCallback:m.metadata?void 0:R,previewUrlCallback:g}))}),[a].concat(e._toConsumableArray(Object.values(m)))),r.useEffect((function(){var e=y.current;e.progress(_);var r=function(){var e=y.current.fileColl.__items.map((function(e){return e.promise()}));E(e)},t=function(){var e=y.current.fileColl.lastProgresses();T(e)};return e.fileColl.anyProgressList.add(t),e.fileColl.anyDoneList.add(r),e.fileColl.anyFailList.add(r),e.fileColl.onRemove.add(r),e.fileColl.onReplace.add(r),e.fileColl.onSort.add(r),function(){var e=y.current;e.fileColl.anyProgressList.remove(t),e.fileColl.anyDoneList.remove(r),e.fileColl.anyFailList.remove(r),e.fileColl.onRemove.remove(r),e.fileColl.onReplace.remove(r),e.fileColl.onSort.remove(r)}}),[].concat(e._toConsumableArray(Object.values(m)),[_,E,T])),r.useImperativeHandle(o,(function(){return{onTabVisibility:function(e){return y.current.onTabVisibility(e)},hideTab:function(e){return y.current.hideTab(e)},showTab:function(e){return y.current.showTab(e)},switchTab:function(e){return y.current.switchTab(e)},addFiles:function(e){return y.current.addFiles(e)},isTabVisible:function(e){return y.current.isTabVisible(e)},getFileColl:function(){return y.current.fileColl},getRawDialogApi:function(){return y.current}}}),[]),r.useEffect((function(){return function(){return y.current&&y.current.reject()}}),[]),r.useEffect((function(){var r=!1;y.current.fileColl.clear();var n,o=c(l),i=e._createForOfIteratorHelper(o);try{for(i.s();!(n=i.n()).done;){var u=n.value;if("string"==typeof u&&u.includes("~")){a.loadFileGroup(u,t).then((function(e){if(!r){var t=e.files();y.current.addFiles(t)}}));break}y.current.fileColl.add(a.fileFrom("uploaded",u,t))}}catch(e){i.e(e)}finally{i.f()}return function(){r=!0}}),[l]),[w]}(t,o.default),C=e._slicedToArray(d,1)[0];return l.default.createElement("div",{id:t.id,className:s,style:u},f,l.default.createElement("div",{ref:C}))};
